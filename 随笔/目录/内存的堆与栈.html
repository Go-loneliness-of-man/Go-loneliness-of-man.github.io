<!DOCTYPE html>
<html>

<head>
  <title></title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="../note.css">
  <style>
    img{ margin:10px 0px; }
    a{ color:rgb(150,150,150); }
  </style>
</head>

<body>
  <div id="h1"><span class="smallh1">堆和栈的区别（数据结构、内存分区）</span></div>
  <div id="body">
    <h3>2018 年 10 月 14 日</h3>
    <h2></h2>
    <p>
      这几天对内存比较感兴趣，就查了查相关资料，了解了下，现在将学到的知识结合自己的理解总结下来。写程序时，堆栈是很重要的概念，我们编写的程序基本上都
      要用到，而对初学者来说，堆栈是很模糊的概念，下面有写的不对的地方还请不吝赐教，这对大家的学习都有帮助。<br>
      堆栈：两种数据结构、在内存中是指两片存放数据的空间。<br>
    </p>
    <span class="em">数据结构的堆、栈</span>
    <p>
      首先是数据结构上的堆栈，尽管这么称呼它，实际上堆、栈是两个概念。先从栈说起，栈就像装数据的桶或箱子，具有先进后出的特性，即先放的在下面，后放的在
      上面。如同要取出放在箱子底部的东西，首先要移开压在其上的物体。说到栈顺便再提下队列，队列和栈刚好相反，是先进先出的，就像排队卖东西一样。
    </p>
    <p>
      堆在数据结构中也称为树。堆是一种经过排序的树形数据结构，每个结点都有一个值。通常我们所说的堆是指二叉堆，堆的特点是根结点的值最小（或最大），根结
      点的每个子树也是一个堆。（由于堆的这个特性，常用来实现优先队列）不同于栈，<span class="em">堆的存取是随意的</span>，如同在书架上取书，虽然
      书的摆放是有顺序的，但是你想取任意一本时不必像栈一样，先取出其上所有的书，书架这种机制不同于箱子，你可以直接取出想要的书。
    </p>
    <span class="em">内存分配中的栈和堆</span><br>
    <p>
      内存中的堆区、栈区和上面说的数据结构中的堆、栈不是一个概念，大家一定要注意。
    </p>
    <p>
      下面说说程序内存分配中的堆、栈，一般情况下程序存放在 rom（相当于硬盘） 或 flash（相当于 U 盘） 中，运行时要拷到内存中执行，内存对不同信息会存
      储在不同的区域。栈区中存储函数、局部变量的空间，堆区用于分配程序员申请的内存空间。另外还有静态区用来存储静态变量，全局变量；只读区是用来存储常量
      和程序代码；还有其他一些分区，不一一列举了。<br>
    </p>
      <span class="em">下面从不同方面介绍堆区、栈区：</span><br><br>
      1. 申请、回收方式不同：<br>
    <p>
      <span class="em">堆、栈的第一个区别是申请方式不同</span>：栈是系统自动分配空间的，例如你定义一个 char a；系统会自动在栈上为其开辟空间。而
      堆则是程序员根据需要自己申请的空间，比如 malloc（10）；开辟 10 个字节的空间。由于栈上的空间是自动分配自动回收的，所以栈上的数据生存周期只是在
      函数运行期间，运行后就释放掉。而堆上的数据只要程序员不手动释放，就一直可以访问，不过一旦忘记释放就会造成内存泄露。<br>
    </p>
      2. 申请后系统的响应：<br><br>
      栈区：只要栈的剩余空间大于所申请空间，系统就会为程序提供内存，否则将报异常提示栈溢出。<br>
      堆区：操作系统有个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历链表寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点链表中删
      除并将该结点的空间分配给程序，对于大多数系统，会在这块内存空间中的首地址处记录本次分配的大小，这样，当代码释放时才能正确的释放该内存空间。另外，
      由于找到的堆结点的大小一般会大于申请的大小，系统会自动的将多余的那部分重新放入空闲链表中。这样，堆区在申请后还要做一些后续工作，这就会造成申
      请效率的问题。<br><br>
      3. 申请效率的比较：<br><br>
      根据 1、2 可知。<br>
      栈区：由系统自动分配，速度较快，但不受程序员控制。<br>
      堆区：是由程序员申请的内存，一般速度比较慢，且容易产生内存碎片，但是用起来很方便。<br><br>
      4. 申请大小的限制<br><br>
      栈区：Windows 下，<span class="em">栈是一块连续的内存空间，栈顶的地址和栈的最大容量是系统预先规定好的</span>，在 Windows 下，单个程序可
      以使用的栈区的大小是 2M 或 1M，如果申请的空间超过栈的剩余空间时，将提示栈溢出 overflow。因此，能从栈获得的空间较小，例如你直接声明一个 25 万
      或 50 万的 int 数组就容易造成栈溢出。<br>
      堆区：<span class="em">堆是不连续的内存区域</span>。这是由于系统是用链表来存储空闲内存地址的，便可以是不连续的，堆的大小受限于计算机系统中有效
      的内存，由此可见，堆能获得的空间比较灵活，也很大。<br><br>
      5. 堆和栈中的存储内容<br><br>
      <span class="em">正由于栈的大小有限，所以程序模块化不仅有逻辑意义，还有其物理意义。</span><br>
      栈：在函数调用时，首先入栈的是主函数中函数调用后的下一条指令（函数调用语句的下一条可执行语句）的地址，然后是函数的各个参数，在大多数的编译器中，
      参数是由右向左入栈的，然后是函数中的局部变量。注意静态变量是不入栈的。当本次函数调用结束后，局部变量先出栈，然后是参数，最后栈顶指针指向最开始存
      的地址，即主函数中的下一条指令，程序由该点继续运行。<br>
      堆：一般在堆的头部有一个字节记录了堆的大小。堆中的具体内容由程序员规定。<br><br>
      6. 存取效率的比较<br><br>
      char s1[] = "aaaaaaaaaaaaaaa";<br>
      char *s2 = "bbbbbbbbbbbbbbbbb";<br>
      aaaaaaaaaaa 是在运行时赋值的，放在栈中，而 bbbbbbbbbbb 是在编译时就确定的，放在堆中。<br>
      在以后的存取中，在栈上的数组比指针所指向的字符串（例如堆）要快。<br>
      使用栈就像去饭馆里吃饭，只管点菜（发出申请）、付钱、和吃（使用），吃饱了就走，不必理会切菜、洗菜等准备工作和洗碗、刷锅等扫尾工作，好处是快捷，但
      是自由度小。使用堆就象是自己动手做喜欢吃的菜肴，比较麻烦，但是更符合自己的口味，自由度大。<br><br>
      暂时就写到这里了，不知看到这里，你是否有所收获？
  </div>
</body>

</html>